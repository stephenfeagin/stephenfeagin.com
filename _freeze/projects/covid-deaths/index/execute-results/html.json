{
  "hash": "2b6dab1b8a559a8a7a115cdd2327847a",
  "result": {
    "markdown": "---\ntitle: \"COVID-19 Deaths in North Carolina: Exploratory Data Analysis\"\ndate: 2023-09-16\nimage: \"deaths_heatmap.png\"\ncategories:\n  - r\n  - tidyverse\n  - data cleaning\n  - public health\n---\n\n\nIn this project, I am going to be conducting an exploratory data analysis working with COVID-19 data from Johns Hopkins University. The data can be found on [GitHub](https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv) with some discussion and context on the JHU [Coronavirus Resource Center website](https://coronavirus.jhu.edu/). I will be plotting that data geographically and bringing in other data sources to explore the relationship between COVID death rates and other demographic, socioeconomic, and health factors. This type of analysis could go on indefinitely until I run out of variables, so I will limit myself to just a few. Note that the purpose of this post is to explore the data and a few relationships and trends, and to demonstrate with R code how to summarize, visualize, and quantify these patterns. I am not attempting to build a predictive model or train an algorithm on this data. \n\nI'll go ahead and load in the packages I will be using.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(janitor)\nlibrary(readxl)\nlibrary(sf)\nlibrary(stargazer)\nlibrary(tidyverse)\n```\n:::\n\n\n## Deaths By County\n\n### Deaths Data Set\n\nFirst, read the data on death counts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths <- read_csv(\"time_series_covid19_deaths_US.csv\", show_col_types = FALSE)\n```\n:::\n\n\nI need to convert this very wide dataset, which has a column for each day, into a long dataset with a `date` variable and a `deaths` variable. I know that I will only be working with North Carolina data, so I can filter down to that. I also convert `date` into an actual date type and trim off some extraneous columns, as well as cleaning up variable names. I also need to make [FIPS](https://en.wikipedia.org/wiki/FIPS_county_code) into a character type.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths_long <- deaths |> \n  filter(Province_State == \"North Carolina\") |> \n  pivot_longer(\n    cols = matches(r\"(\\d{1,2}/\\d{1,2}/\\d{2})\"),\n    names_to = \"date\",\n    values_to = \"deaths\"\n  ) |> \n  mutate(\n    date = as_date(date, format = \"%m/%d/%y\"),\n    FIPS = as.character(FIPS)\n  ) |> \n  clean_names() |> \n  rename(\n    county = admin2,\n    state = province_state\n  ) |> \n  select(fips, county, state, population, date, deaths)\n```\n:::\n\n\nTo get a bit better sense of what this data set looks like, I first zoom in on my hometown's Henderson County, NC.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhenderson_county <- deaths_long |> \n  filter(county == \"Henderson\")\n```\n:::\n\n\nI can make a quick plot of deaths over time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(henderson_county, aes(x = date, y = deaths)) +\n  geom_line() +\n  labs(x = \"Date\", y = \"Deaths\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nThis shows us that the `deaths` variable is the cumulative total deaths over time, not new deaths reported at each data point.\n\n### County Borders\n\nI got the GeoJSON file with the state and county borders from [NC One Map](https://www.nconemap.gov/datasets/9728285994804c8b9f20ce58bae45899_0/explore).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborders <- read_sf(\"nc_borders.geojson\") |> \n  clean_names()\n```\n:::\n\n\nJust a quick look at the map that provided:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(borders) + geom_sf() + theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nIn the COVID deaths data frame, FIPS codes are listed with state concatenated with county, but the `borders` data frame only lists the county. In order to be able to join the two together, I add the state FIPS code onto the `borders` data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborders <- borders |> \n  mutate(fips = paste0(\"37\", fips))\n```\n:::\n\n\nNext, I want to get the overall total deaths for each county. I take the most recent date of data, because the death numbers reported are cumulative. I then calculate the number of deaths per thousand residents.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntotal_deaths <- deaths_long |> \n  slice_max(date) |> \n  mutate(deaths_per_thousand = (deaths / population) * 1000)\n```\n:::\n\n\nJoining the deaths data frame with the borders data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\njoined_deaths_and_borders <- borders |> \n  inner_join(\n    total_deaths,\n    by = \"fips\"\n  )\n```\n:::\n\n\n### Results\n\nFinally, I can plot the deaths per thousand over the map of NC counties.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(joined_deaths_and_borders, aes(fill = deaths_per_thousand)) +\n  geom_sf() +\n  scale_fill_distiller(palette = \"YlOrRd\", direction = 1) +\n  labs(fill = \"Deaths per\\nthousand residents\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nWhich counties had the most deaths per thousand residents?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntotal_deaths |> \n  slice_max(deaths_per_thousand, n = 10) |> \n  select(county, deaths_per_thousand)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 2\n   county      deaths_per_thousand\n   <chr>                     <dbl>\n 1 Rutherford                 6.46\n 2 Surry                      5.86\n 3 Montgomery                 5.45\n 4 Columbus                   5.30\n 5 Jones                      5.20\n 6 Northampton                4.98\n 7 Washington                 4.92\n 8 Cherokee                   4.79\n 9 Chowan                     4.73\n10 Richmond                   4.73\n```\n:::\n:::\n\n\nWhich counties had the fewest?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntotal_deaths |> \n  slice_min(deaths_per_thousand, n = 10) |> \n  select(county, deaths_per_thousand)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 2\n   county      deaths_per_thousand\n   <chr>                     <dbl>\n 1 Dare                      0.892\n 2 Camden                    0.920\n 3 Orange                    1.06 \n 4 Wake                      1.18 \n 5 Durham                    1.23 \n 6 Franklin                  1.38 \n 7 Watauga                   1.39 \n 8 Currituck                 1.44 \n 9 Pitt                      1.59 \n10 Mecklenburg               1.70 \n```\n:::\n:::\n\n\n## Median Income\n\nI got data on unemployment and household income from the [USDA Economic Research Service](https://data.ers.usda.gov/reports.aspx?ID=17828). I downloaded it in `.xlsx` format because the csv somehow didn't contain the same data. Even though I have the data for unemployment available, I am not going to consider that in this exploratory analysis. COVID lockdowns and the economic fallout of the pandemic had very obvious impacts on unemployment, but the relationship is more complicated than what I think I can accomplish here with the data that I have. So I will just be looking at median income by county for 2021. I will filter out the statewide total.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome <- read_excel(\"UnemploymentReport.xlsx\", skip = 2) |> \n  clean_names() |> \n  select(fips, name, median_household_income_2021) |> \n  rename(median_income = median_household_income_2021) |> \n  filter(name != \"North Carolina\")\n```\n:::\n\n\nI can first get some summary statistics to get a sense of the distribution of the data..\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(income$median_income)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  38613   45556   52680   55008   60517   91558 \n```\n:::\n:::\n\nFor the histogram, I include a reference line for the average median income.\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(income, aes(x = median_income)) +\n  geom_histogram(binwidth = 2500, color = \"black\") +\n  geom_vline(aes(xintercept = mean(median_income), color = \"mean\")) +\n  scale_color_manual(name = \"Reference\", values = c(mean = \"red\")) +\n  labs(x = \"Median Income\", y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\nNext, I can plot median income by county.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_join(borders, income, by = \"fips\") |> \n  ggplot(aes(fill = median_income)) +\n  geom_sf() + \n  labs(fill = \"Median Income\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nWhich counties have the highest median income?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome |> \n  slice_max(median_income, n = 10) |> \n  select(name, median_income)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 2\n   name                   median_income\n   <chr>                          <dbl>\n 1 Wake County, NC                91558\n 2 Union County, NC               87553\n 3 Chatham County, NC             82764\n 4 Currituck County, NC           82759\n 5 Orange County, NC              79814\n 6 Camden County, NC              79162\n 7 Cabarrus County, NC            79148\n 8 Mecklenburg County, NC         75138\n 9 Lincoln County, NC             73319\n10 Durham County, NC              71436\n```\n:::\n:::\n\n\nAnd the lowest?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome |> \n  slice_min(median_income, n = 10) |> \n  select(name, median_income)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 2\n   name                   median_income\n   <chr>                          <dbl>\n 1 Robeson County, NC             38613\n 2 Halifax County, NC             38944\n 3 Tyrrell County, NC             39970\n 4 Hertford County, NC            40461\n 5 Northampton County, NC         40524\n 6 Anson County, NC               40773\n 7 Edgecombe County, NC           41157\n 8 Columbus County, NC            41206\n 9 Bertie County, NC              41280\n10 Richmond County, NC            42158\n```\n:::\n:::\n\n\nI am curious whether there is a relationship between death counts and median income. To examine that, I will need to join the data sets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths_and_income <- inner_join(\n  total_deaths,\n  income,\n  by = \"fips\"\n)\n```\n:::\n\n\nI can do a plot of income versus death rate:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(deaths_and_income, aes(x = median_income, y = deaths_per_thousand)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(x = \"Median Income\", y = \"Deaths per Thousand Residents\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nThere is a pretty clear negative correlation between median income and coronavirus death rate. We can quantify this using a simple regression model:\n\n\n\n```{.r .cell-code}\nmodel_death_income <- lm(\n  deaths_per_thousand ~ median_income, \n  data = deaths_and_income\n)\nstargazer(model_death_income, type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">median_income</td><td>-0.0001<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.00001)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>6.945<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.443)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>100</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.413</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.407</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>0.916 (df = 98)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>69.060<sup>***</sup> (df = 1; 98)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\n\nThe results are a bit hard to make sense of because the unit of `median_income` is dollar, and so the coefficient on that term tells us the predicted change in `deaths_per_thousand` *per one additional dollar* of income. That is a very small scale. Just to make it a little easier to parse, I will adjust the model to regress on median income in tens of thousands of dollars. That way, the coefficient will represent predicted change in death rate per additional \\$10,000 dollars.\n\n\n\n```{.r .cell-code}\nmodel_death_income_adjusted <- lm(\n  deaths_per_thousand ~ I(median_income / 10000),\n  data = deaths_and_income\n)\n\nstargazer(model_death_income_adjusted, type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">I(median_income/10000)</td><td>-0.654<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.079)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>6.945<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.443)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>100</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.413</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.407</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>0.916 (df = 98)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>69.060<sup>***</sup> (df = 1; 98)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\n\nWe can interpret this as saying that for a change in median income of \\$10,000, the average death rate per thousand residents decreases by 0.65. Given that the entire range of the death rate variable covers just 0.9 to 6.5, that's a substantial association. This is obviously a very simple model that doesn't control for other variables, but it is an interesting first pass at that correlation.\n\n\n## Health and Social Factors\n\nI downloaded a large dataset from the [North Carolina Institute of Medicine](https://nciom.org/nc-health-data/map/), which you can download [here](county_health_data_2021.xlsx). As is the case with many publicly available data spreadsheets, it was made more for humans to read than for machines to read, so it will take some cleaning up to use. I want to skip the first row so that I can use the second row which has all of the county names as the column labels, but that will require me to manually name the first few columns myself.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhealth_data <- read_excel(\"county_health_data_2021.xlsx\", skip = 1)\nnames(health_data)[1:7] <- c(\n  \"indicator_category\",\n  \"indicator_name\",\n  \"indicator_descriptor\",\n  \"source_label\",\n  \"source_link\",\n  \"blank\",\n  \"nc\"\n)\n```\n:::\n\n\nI think for the most part I will be pulling individual indicators out of this data and then pivoting the row from wide to long. There are too many variables in this spreadsheet to include all of them in this post, so I will be focusing on three that I think will be particularly interesting: elderly population, concentration of primary care physicians, and adult smoking prevalence.\n\n### Elderly Population\n\nThe first that I would like to look at is elderly population, which is the percent of the population aged 65 or older. I expect the percentage of elderly residents to be positively correlated with COVID-19 deaths, because they are among the most vulnerable populations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nelderly_pop <- health_data |> \n  filter(indicator_name == \"Elderly Population\") |> \n  pivot_longer(\n    cols = -c(1:7),\n    names_to = \"county\",\n    values_to = \"elderly_pop\"\n  ) |> \n  select(county, elderly_pop) |> \n  filter(!(county %in% c(\"Data year\", \"Data Notes\"))) |> \n  mutate(elderly_pop = as.numeric(elderly_pop))\n```\n:::\n\n\nWhat do the elderly population numbers look like?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(elderly_pop$elderly_pop)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n 0.0960  0.1718  0.2030  0.2056  0.2367  0.3260 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(elderly_pop, aes(x = elderly_pop)) +\n  geom_histogram(binwidth = 0.01, color = \"black\") +\n  geom_vline(aes(xintercept = mean(elderly_pop), color = \"mean\")) +\n  scale_color_manual(name = \"Reference\", values = c(mean = \"red\")) +\n  labs(x = \"% Elderly Population\", y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\nI can make a quick map of that data by combining this data frame with `borders`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborders |> \n  inner_join(elderly_pop, by = \"county\") |> \n  ggplot(aes(fill = elderly_pop)) +\n  labs(fill = \"% Elderly Population\") +\n  geom_sf() +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\nI will join `elderly_pop` onto `total_deaths` to see how well elderly population correlates with COVID deaths:\n\n\n::: {.cell}\n\n```{.r .cell-code}\njoined_deaths_and_elderly <- inner_join(\n  total_deaths,\n  elderly_pop,\n  by = \"county\"\n)\n\nggplot(joined_deaths_and_elderly, aes(x = elderly_pop, y = deaths_per_thousand)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(x = \"% Elderly Population\", y = \"Deaths per 1,000\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\nHow strong is that relationship? I will convert the decimal `elderly_pop` into a percentage to make interpreting the coefficients simpler.\n\n\n\n```{.r .cell-code}\nlm(deaths_per_thousand ~ I(elderly_pop * 100), data = joined_deaths_and_elderly) |> \n  stargazer(type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">I(elderly_pop * 100)</td><td>0.075<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.023)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>1.814<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.486)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>100</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.097</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.088</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>1.137 (df = 98)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>10.515<sup>***</sup> (df = 1; 98)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\nA fairly strong positive association: for an increase in elderly population of one percentage point, we can expect an addition 0.075 COVID deaths per thousand residents, with p < 0.01.\n\n### Physician Concentration\n\nWe also have data on number of primary care physicians per 10,000 population. I expect that to be strongly negatively correlated with COVID deaths. I also expect that the areas with the highest physician concentration will be clustered around the Triangle and Charlotte, with upticks in Forsyth County and Pitt County where other medical schools are. It wouldn't surprise me if Buncombe and maybe New Hanover Counties are also high.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphysicians <- health_data |> \n  filter(indicator_name == \"Health Care Workforce - Primary Care Physicians\") |> \n  pivot_longer(\n    cols = -c(1:7),\n    names_to = \"county\",\n    values_to = \"physicians\"\n  ) |> \n  select(county, physicians) |> \n  filter(!(county %in% c(\"Data year\", \"Data Notes\"))) |> \n  mutate(physicians = as.numeric(physicians))\n```\n:::\n\n\nLet's take a look at the general distribution of physicians.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(physicians$physicians)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  0.000   3.500   4.900   5.266   6.400  22.100 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(physicians, aes(x = physicians)) +\n  geom_histogram(binwidth = .5, color = \"black\") +\n  geom_vline(aes(xintercept = mean(physicians), color = \"mean\")) +\n  scale_color_manual(name = \"Reference\", values = c(mean = \"red\")) +\n  labs(x = \"Primary Care Providers per 10k\", y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\nThere's a very clear outlier -- what exactly are the counties with the highest primary care presence?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphysicians |> \n  slice_max(physicians, n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 2\n   county      physicians\n   <chr>            <dbl>\n 1 Orange            22.1\n 2 Buncombe          13  \n 3 Durham            12.6\n 4 Forsyth           11.4\n 5 Pitt              11.1\n 6 Swain             10.5\n 7 Hertford           9.6\n 8 Mecklenburg        9.5\n 9 Mitchell           8.5\n10 Wake               8.5\n```\n:::\n:::\n\nI was right about the Triangle, Charlotte, and Asheville, but Wilmington's New Hanover County doesn't make the top ten.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborders |> \n  inner_join(physicians, by = \"county\") |> \n  ggplot(aes(fill = physicians)) +\n  geom_sf() + \n  labs(fill = \"Primary Care\\nProviders per 10k\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\nLet's see how the correlation between physician presence and COVID deaths looks:\n\n\n::: {.cell}\n\n```{.r .cell-code}\njoined_deaths_and_physicians <- inner_join(\n  total_deaths,\n  physicians,\n  by = \"county\"\n)\n\nggplot(joined_deaths_and_physicians, aes(x = physicians, y = deaths_per_thousand)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(x = \"Primary Care Providers per 10k\", y = \"Deaths per 1,000\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\nThat is a fairly negative association, but it looks Orange County may have disproportionate leverage on that finding. What does it look like without Orange County?\n\n\n::: {.cell}\n\n```{.r .cell-code}\njoined_deaths_and_physicians |> \n  filter(county != \"Orange\") |> \n  ggplot(aes(x = physicians, y = deaths_per_thousand)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(x = \"Primary Care Providers per 10k\", y = \"Deaths per 1,000\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\nWithout Orange County, the line looks much flatter, and the confidence interval is such that we can't necessarily rule out a null result. What do the regression numbers look like?\n\n\n\n```{.r .cell-code}\nlm(\n  deaths_per_thousand ~ physicians,\n  data = joined_deaths_and_physicians\n) |> \n  stargazer(type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">physicians</td><td>-0.084<sup>**</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.038)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>3.791<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.233)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>100</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.047</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.038</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>1.168 (df = 98)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>4.860<sup>**</sup> (df = 1; 98)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\nAs we could tell visually, not a strong association. I expect that removing Orange County will weaken it further:\n\n\n\n```{.r .cell-code}\nexclude_oc <- lm(\n  deaths_per_thousand ~ physicians,\n  data = filter(joined_deaths_and_physicians, county != \"Orange\")\n  )\nstargazer(exclude_oc, type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">physicians</td><td>-0.062</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.046)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>3.683<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.263)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>99</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.018</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.008</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>1.169 (df = 97)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>1.793 (df = 1; 97)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\nThis one really surprised me. I definitely expected a fairly robust correlation between PCP presence and COVID deaths. I am curious how the model would look if we controlled for elderly population.\n\n\n\n```{.r .cell-code}\ncontrol_for_elderly <- lm(\n  deaths_per_thousand ~ physicians + elderly_pop,\n  data = inner_join(elderly_pop, joined_deaths_and_physicians, by = \"county\")\n)\nstargazer(control_for_elderly, type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">physicians</td><td>-0.059</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.038)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">elderly_pop</td><td>6.597<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(2.346)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>2.303<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.575)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>100</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.119</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.101</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>1.129 (df = 97)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>6.554<sup>***</sup> (df = 2; 97)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\n`physicians` doesn't become significant even after controlling for elderly population. I must say I'm surprised by this, I really expected a strong relationship. But that's why we look at data -- to hopefully be surprised.\n\n### Adult Smoking\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmokers <- health_data |> \n  filter(indicator_name == \"Adult Smoking\") |> \n  pivot_longer(\n    cols = -c(1:7),\n    names_to = \"county\",\n    values_to = \"smokers\"\n  ) |> \n  select(county, smokers) |> \n  filter(!(county %in% c(\"Data year\", \"Data Notes\"))) |> \n  mutate(smokers = as.numeric(smokers) * 100)\n```\n:::\n\n\nSummary statistics:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(smokers$smokers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   12.0    16.0    17.5    17.5    19.0    24.0 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(smokers, aes(x = smokers)) +\n  geom_histogram(binwidth = 1, color = \"black\") +\n  geom_vline(aes(xintercept = mean(smokers), color = \"mean\")) +\n  scale_fill_manual(name = \"Reference\", values = c(mean = \"red\")) +\n  labs(x = \"Adult Smokers (%)\", y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\nMapping smoking prevalence:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborders |> \n  inner_join(smokers, by = \"county\") |> \n  ggplot(aes(fill = smokers)) +\n  geom_sf() + \n  labs(fill = \"Adult Smoking (%)\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\nWhat is the correlation between smoking prevalence and COVID deaths? I expect there to be a very clear positive relationship.\n\n\n::: {.cell}\n\n```{.r .cell-code}\njoined_deaths_and_smokers <- inner_join(\n  total_deaths,\n  smokers,\n  by = \"county\"\n)\n\nggplot(joined_deaths_and_smokers, aes(x = smokers, y = deaths_per_thousand)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(x = \"Adult Smokers (%)\", y = \"Deaths per 1,000\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\nThe trend is very clear visually. Quantitatively:\n\n\n\n```{.r .cell-code}\nmodel_death_smokers <- lm(\n  deaths_per_thousand ~ smokers,\n  data = joined_deaths_and_smokers\n)\nstargazer(model_death_smokers, type = \"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>deaths_per_thousand</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">smokers</td><td>0.271<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.053)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>-1.392</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.939)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>100</td></tr>\n<tr><td style=\"text-align:left\">R<sup>2</sup></td><td>0.208</td></tr>\n<tr><td style=\"text-align:left\">Adjusted R<sup>2</sup></td><td>0.200</td></tr>\n<tr><td style=\"text-align:left\">Residual Std. Error</td><td>1.064 (df = 98)</td></tr>\n<tr><td style=\"text-align:left\">F Statistic</td><td>25.813<sup>***</sup> (df = 1; 98)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\nAs expected, there is a strong positive relationship between smoking prevalence and COVID death rate. In this case, an increase in adult smoking prevalence of one percentage point is associated with an increase in COVID death rate of 0.27 deaths per 1,000 individuals.\n\n## Conclusion\n\nThis has been a really interesting and fun exercise. In general, the relationships that I examined were not particularly surprising, but I was shocked to see that there was no significant relationship between physician concentration and COVID death rate. It's worth thinking about why that might be the case and exploring the relationship between primary care and severe acute health outcomes. In the future, I may revisit these data sets to build a machine learning model to predict COVID death rate from these and other covariates. Thanks for reading!\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}