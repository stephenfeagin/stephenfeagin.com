{
  "hash": "1bcf91fa6e9b9a8c0cb40bea5e26a064",
  "result": {
    "markdown": "---\ntitle: \"The Weight of Advantage and Disadvantage in Dungeons & Dragons\"\nauthor: Stephen Feagin\ndate: '2023-08-30'\ncategories:\n  - r\n  - d&d\n  - probability\ndescription: 'How much does advantage help, and how much does disadvantage hurt?'\ndraft: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(ggplot2))\n```\n:::\n\n\nIn Dungeons & Dragons 5th Edition, player actions are generally resolved by rolling a 20 sided die (a d20) and adding a relevant modifier. The Game Master may allow a player to roll with either advantage or disadvantage. In both cases, you roll the d20 twice. With advantage, you take the higher of the two values, and with disadvantage you take the lower. Now the average roll of a d20 is 10.5:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(1:20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 10.5\n```\n:::\n:::\n\n\nBut how do advantage and disadvantage affect that?\n\nBecause this analysis involves random sampling, I use `set.seed()` to ensure replicability:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2023)\n```\n:::\n\n\nFor both of these, we start by making repeated pairs of draws from a uniform distribution from 1 to 20. For advantage, we take the maximum, and for disadvantage we take the minimum. I will be using a total of 1 million pairs of draws, just to make sure we really get the [law of large numbers](https://en.wikipedia.org/wiki/Law_of_large_numbers) working for us.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 1e6\ndraws <- matrix(0, nrow = n, ncol = 4)\ncolnames(draws) <- c(\"draw_1\", \"draw_2\", \"advantage\", \"disadvantage\")\ndraws[, c(\"draw_1\", \"draw_2\")] <- replicate(\n  n = n, \n  sample(1:20, size = 2, replace = TRUE)\n)\n```\n:::\n\n\nNext, I take the maximum and minimum values of each pair for the `advantage` and `disadvantage` columns, respectively. Here, `apply()` takes an input matrix, in this case the columns `draw_1` and `draw_2` from the `draws` matrix. The second argument, `1`, tells it to apply the function, `max()` over the rows of the input matrix. That is, for each row, apply the `max()` function. The `MARGIN` argument of `1` indicates rows because in matrix subsetting in R, the first term indicates the row and the second term indicates the column, i.e. `draws[5,10]` indicates the 5th row of the 10th column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndraws[, \"advantage\"] <- apply(draws[, 1:2], 1, max)\ndraws[, \"disadvantage\"] <- apply(draws[, 1:2], 1, min)\n```\n:::\n\n\nWe can plot the frequency distributions for these. For a standard roll, i.e. just the first draw, we should expect a roughly uniform distribution across all values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(draws), aes(x = draw_1)) + \n  geom_bar(col = \"black\") + \n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nBecause of the very large number of rolls, we do see the distribution has mostly converged to the expected uniform distribution of the population.\n\nFor advantage:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(draws), aes(x = advantage)) + \n  geom_bar(col = \"black\") + \n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nIn this case, we have a PMF that is linear in $x$. The PMF thus resembles $P(X=x) = a+bx : 1 \\leq x \\leq 20$, where the probability of $X=x$ is greater and greater for each increasing value of $x$. Solving a simple system of equations using the $P(X=1)$ and $P(X=20)$, I have calculated $a\\approx-0.0025$ and $b\\approx0.005$. This could also be solved using linear regression. To do that, I get the proportions of roll results from the advantage rolls and regress that proportion on the roll value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- data.frame(table(draws[, \"advantage\"]) / n)\ncolnames(df) <- c(\"x\", \"p_x\")\ndf$x <- as.numeric(df$x)  # `table` produces a factor for this value\nlm(p_x ~ x, data = df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = p_x ~ x, data = df)\n\nCoefficients:\n(Intercept)            x  \n  -0.002506     0.005001  \n```\n:::\n:::\n\n\nFor disadvantage:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(draws), aes(x = disadvantage)) + \n  geom_bar(col = \"black\") + \n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nWe can repeat the process used for advantage to calculate the parameters for the disadvantage distribution:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- data.frame(table(draws[, \"disadvantage\"]) / n)\ncolnames(df) <- c(\"x\", \"p_x\")\ndf$x <- as.numeric(df$x)\nlm(p_x ~ x, data = df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = p_x ~ x, data = df)\n\nCoefficients:\n(Intercept)            x  \n   0.102383    -0.004989  \n```\n:::\n:::\n\n\n<hr>\n\nThen I compute the mean and standard deviation of each:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- data.frame(\n  type = c(\"Standard\", \"Advantage\", \"Disadvantage\"),\n  mean = c(mean(draws[, \"draw_1\"]), mean(draws[, \"advantage\"]), mean(draws[, \"disadvantage\"])),\n  sd = c(sd(draws[, \"draw_1\"]), sd(draws[, \"advantage\"]), sd(draws[, \"disadvantage\"]))\n)\n\nresults\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          type     mean       sd\n1     Standard 10.50629 5.761983\n2    Advantage 13.82537 4.705335\n3 Disadvantage  7.18243 4.711922\n```\n:::\n:::\n\n\nIt's pretty clear that advantage and disadvantage substantially affect the average result. We can quantify that difference using a t-test to measure difference in means. For advantage:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(draws[, \"advantage\"], draws[, \"draw_1\"])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  draws[, \"advantage\"] and draws[, \"draw_1\"]\nt = 446.17, df = 1923180, p-value < 2.2e-16\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n 3.304502 3.333662\nsample estimates:\nmean of x mean of y \n 13.82537  10.50629 \n```\n:::\n:::\n\n\nWe get a 95% confidence interval of (3.31, 3.34), and it makes sense that we would get such a tight interval given an n of 1,000,000.\n\nFor disadvantage:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(draws[, \"draw_1\"], draws[, \"disadvantage\"])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  draws[, \"draw_1\"] and draws[, \"disadvantage\"]\nt = 446.56, df = 1924170, p-value < 2.2e-16\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n 3.309267 3.338445\nsample estimates:\nmean of x mean of y \n 10.50629   7.18243 \n```\n:::\n:::\n\n\nSo next time, do your best to get advantage however you can, and avoid disadvantage at all costs. The probability of getting a natural 20 with advantage nearly double compared to a standard roll, and the same goes for getting a natural 1 with disadvantage. Happy gaming!\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}